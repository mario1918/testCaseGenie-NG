<!-- TestCaseGenie Angular Application -->
<div class="container-fluid">
  <div class="row g-4">
    <div class="col-12">
      <div class="card border-0 shadow-sm rounded-3 overflow-hidden">
        <!-- Header -->
        <div class="card-header bg-gradient-primary text-white py-3">
          <div class="d-flex justify-content-between">
            <div>
              <h1 class="h4 mb-0 fw-bold d-flex align-items-center gap-2">
                <i class="bi bi-magic text-white"></i>
                <span>{{ title }}</span>
              </h1>
              <p class="mb-0 mt-3 opacity-85" style="font-size: 0.9rem;">
                Instantly convert <strong>User Stories</strong> into clear, reusable <strong>Test Cases</strong> with AI
              </p>
            </div>
            <div class="d-flex flex-column align-items-end" style="gap: 0.25rem">
              <span class="badge bg-white text-primary px-3 py-2 d-flex align-items-center gap-1">
                <i class="bi bi-stars text-warning"></i>
                <span>AI-Powered</span>
              </span>
              <button 
                (click)="themeService.toggleTheme()" 
                class="btn btn-sm btn-outline-light p-0" 
                title="Toggle theme" 
                style="width: 33px; height: 33px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; margin-left: auto;">
                <i class="bi" [ngClass]="themeService.isDarkTheme() ? 'bi-moon-fill' : 'bi-sun-fill'"></i>
              </button>
            </div>
          </div>
        </div>

        <div class="card-body p-4">
          <!-- Search and Filters Section -->
          <div class="row g-3 mb-4">
            <div class="col-12">
              <h3 class="h5 mb-3"><i class="bi bi-funnel"></i> Search & Filter Jira Issues</h3>
            </div>
            
            <!-- JQL Search -->
            <div class="col-12">
              <label for="jqlFilter" class="form-label">JQL Search</label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-search"></i></span>
                <input 
                  type="text" 
                  class="form-control" 
                  id="jqlFilter" 
                  [(ngModel)]="jqlFilter"
                  placeholder="Enter JQL query (e.g., project = SE2 AND status = 'In Progress')"
                  (keyup.enter)="applyFilters()">
                <button class="btn btn-outline-primary" type="button" (click)="applyFilters()">
                  <i class="bi bi-search"></i> Search
                </button>
              </div>
              <div class="form-text">Use JQL syntax to search for specific issues</div>
            </div>

            <!-- Filter Controls -->
            <div class="col-md-4">
              <label for="issueTypeFilter" class="form-label">Issue Type</label>
              <select class="form-select" id="issueTypeFilter" [(ngModel)]="issueTypeFilter">
                <option value="">All Types</option>
                <option value="Story">User Story</option>
                <option value="Task">Task</option>
                <option value="Bug">Bug</option>
                <option value="Epic">Epic</option>
                <option value="Sub-task">Sub-task</option>
              </select>
            </div>

            <div class="col-md-4">
              <label for="componentFilter" class="form-label">Component</label>
              <select class="form-select" id="componentFilter" [(ngModel)]="componentFilter">
                <option value="">All Components</option>
                <option *ngFor="let component of components" [value]="component.name">
                  {{ component.name }}
                </option>
              </select>
            </div>

            <div class="col-md-4">
              <label for="sprintFilter" class="form-label">Sprint</label>
              <select class="form-select" id="sprintFilter" [(ngModel)]="sprintFilter">
                <option value="">All Sprints</option>
                <option *ngFor="let sprint of sprints" [value]="sprint.name">
                  {{ sprint.name }} ({{ sprint.state }})
                </option>
              </select>
            </div>

            <!-- Action Buttons -->
            <div class="col-12">
              <div class="d-flex gap-2">
                <button (click)="applyFilters()" class="btn btn-primary">
                  <i class="bi bi-funnel"></i> Apply Filters
                </button>
                <button (click)="clearFilters()" class="btn btn-outline-secondary">
                  <i class="bi bi-x-circle"></i> Clear All
                </button>
                <button (click)="loadJiraIssues()" class="btn btn-outline-info">
                  <i class="bi bi-arrow-clockwise"></i> Refresh
                </button>
              </div>
            </div>
          </div>

          <!-- Jira Issues Section -->
          <div class="mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h3 class="h5 mb-0">
                <i class="bi bi-list-task"></i> Jira Issues
                <span class="badge bg-primary ms-2" *ngIf="totalResults > 0">{{ totalResults }}</span>
              </h3>
              <div class="text-muted">{{ paginationInfo }}</div>
            </div>

            <!-- Loading State -->
            <div *ngIf="isLoadingIssues" class="text-center py-5">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
              <p class="mt-2 text-muted">Loading Jira issues...</p>
            </div>

            <!-- Issues Table -->
            <div *ngIf="!isLoadingIssues" class="table-responsive rounded-3 border">
              <table class="table table-hover align-middle mb-0">
                <thead class="table-light sticky-top">
                  <tr>
                    <th style="width: 120px;">Key</th>
                    <th style="min-width: 200px;">Summary</th>
                    <th style="min-width: 250px;">Description</th>
                    <th style="width: 100px;">Type</th>
                    <th style="width: 100px;">Status</th>
                    <th style="width: 100px;">Priority</th>
                    <th style="width: 120px;">Assignee</th>
                    <th style="width: 120px;">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- No Issues Message -->
                  <tr *ngIf="jiraIssues.length === 0">
                    <td colspan="8" class="text-center py-5">
                      <i class="bi bi-inbox display-1 text-muted"></i>
                      <p class="mt-3 text-muted">No issues found matching your criteria</p>
                      <button class="btn btn-outline-primary" (click)="clearFilters()">
                        <i class="bi bi-arrow-clockwise"></i> Reset Filters
                      </button>
                    </td>
                  </tr>

                  <!-- Issue Rows -->
                  <tr *ngFor="let issue of jiraIssues; trackBy: trackByIssueKey" class="fade-in">
                    <td>
                      <a [href]="'https://arrowecommerce.atlassian.net/browse/' + issue.key" 
                         target="_blank" 
                         class="text-decoration-none fw-semibold text-primary">
                        {{ issue.key }}
                        <i class="bi bi-box-arrow-up-right ms-1 small"></i>
                      </a>
                    </td>
                    <td>
                      <div class="fw-medium">{{ badgeUtils.truncateText(issue.summary, 60) }}</div>
                      <small class="text-muted" *ngIf="issue.sprint">Sprint: {{ issue.sprint }}</small>
                    </td>
                    <td>
                      <div class="text-muted">{{ badgeUtils.truncateText(issue.description, 120) }}</div>
                    </td>
                    <td>
                      <span 
                        class="badge" 
                        [style]="badgeUtils.getIssueTypeBadgeClass(issue.issue_type).style">
                        {{ issue.issue_type || 'N/A' }}
                      </span>
                    </td>
                    <td>
                      <span 
                        class="badge" 
                        [style]="badgeUtils.getStatusBadgeClass(issue.status).style">
                        {{ issue.status || 'N/A' }}
                      </span>
                    </td>
                    <td>
                      <span 
                        class="badge" 
                        [style]="badgeUtils.getPriorityBadgeClass(issue.priority).style">
                        {{ issue.priority || 'N/A' }}
                      </span>
                    </td>
                    <td>
                      <span class="badge bg-light text-dark border">
                        {{ issue.assignee || 'Unassigned' }}
                      </span>
                    </td>
                    <td>
                      <div class="btn-group btn-group-sm">
                        <button 
                          (click)="showIssueDetails(issue)"
                          class="btn btn-primary" 
                          title="Generate Test Cases">
                          <i class="bi bi-magic"></i>
                        </button>
                        <button 
                          class="btn btn-outline-info"
                          (click)="viewIssueDetails(issue)"
                          title="View Details">
                          <i class="bi bi-eye"></i>
                        </button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>

              <!-- Pagination -->
              <div class="d-flex justify-content-between align-items-center p-3 border-top bg-light" *ngIf="jiraIssues.length > 0">
                <div class="text-muted">{{ paginationInfo }}</div>
                <nav>
                  <ul class="pagination pagination-sm mb-0">
                    <li class="page-item" [class.disabled]="!canGoToPreviousPage">
                      <button 
                        class="page-link" 
                        (click)="previousPage()"
                        [disabled]="!canGoToPreviousPage">
                        <i class="bi bi-chevron-left"></i> Previous
                      </button>
                    </li>
                    <li class="page-item active">
                      <span class="page-link">
                        Page {{ Math.floor(currentStartAt / maxResults) + 1 }}
                      </span>
                    </li>
                    <li class="page-item" [class.disabled]="!canGoToNextPage">
                      <button 
                        class="page-link" 
                        (click)="nextPage()"
                        [disabled]="!canGoToNextPage">
                        Next <i class="bi bi-chevron-right"></i>
                      </button>
                    </li>
                  </ul>
                </nav>
              </div>
            </div>
          </div>

          <!-- Test Cases Section -->
          <div class="mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h3 class="h5 mb-0">
                <i class="bi bi-clipboard-check"></i> Generated Test Cases
                <span *ngIf="currentIssue" class="badge bg-primary ms-2">{{ currentIssue.key }}</span>
                <span class="badge bg-secondary ms-1" *ngIf="testCases.length > 0">{{ testCases.length }}</span>
              </h3>
              <div class="d-flex gap-2">
                <button 
                  (click)="generateMoreTestCases()" 
                  class="btn btn-outline-primary btn-sm" 
                  [disabled]="!currentIssue || isGeneratingTestCases"
                  title="Generate additional test cases">
                  <i class="bi bi-plus-circle"></i> Generate More
                </button>
                <button 
                  (click)="showAddTestCaseModal()" 
                  class="btn btn-primary btn-sm">
                  <i class="bi bi-plus"></i> Add Manual
                </button>
                <button 
                  (click)="exportToExcel()" 
                  class="btn btn-success btn-sm" 
                  [disabled]="testCases.length === 0">
                  <i class="bi bi-file-earmark-excel"></i> Export Excel
                </button>
                <button 
                  (click)="showImportToJiraModal()" 
                  class="btn btn-info btn-sm" 
                  [disabled]="!canImportToJira"
                  title="Import test cases to Jira">
                  <i class="bi bi-upload"></i> Import to Jira
                </button>
              </div>
            </div>

            <!-- Test Cases Loading -->
            <div *ngIf="isGeneratingTestCases" class="text-center py-5 border rounded-3 bg-light">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Generating...</span>
              </div>
              <p class="mt-2 text-muted">AI is generating test cases...</p>
            </div>

            <!-- Test Cases Table -->
            <div *ngIf="!isGeneratingTestCases" class="table-responsive rounded-3 border">
              <table class="table table-striped table-hover align-middle mb-0">
                <thead class="table-light">
                  <tr>
                    <th style="width: 80px;">ID</th>
                    <th style="min-width: 200px;">Title</th>
                    <th style="min-width: 300px;">Steps</th>
                    <th style="min-width: 250px;">Expected Result</th>
                    <th style="width: 100px;">Priority</th>
                    <th style="width: 120px;">Status</th>
                    <th style="width: 120px;">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- No Test Cases Message -->
                  <tr *ngIf="testCases.length === 0">
                    <td colspan="7" class="text-center py-5">
                      <i class="bi bi-clipboard-x display-1 text-muted"></i>
                      <p class="mt-3 text-muted">No test cases generated yet</p>
                      <p class="text-muted">Select a Jira issue and click "Generate" to create test cases</p>
                    </td>
                  </tr>

                  <!-- Test Case Rows -->
                  <tr *ngFor="let testCase of testCases; let i = index; trackBy: trackByTestCaseId" class="fade-in">
                    <td class="fw-medium">{{ testCase.id }}</td>
                    <td>
                      <div class="fw-medium">{{ testCase.title }}</div>
                    </td>
                    <td>
                      <div class="text-wrap" style="max-width: 300px;">{{ testCase.steps }}</div>
                    </td>
                    <td>
                      <div class="text-wrap" style="max-width: 250px;">{{ testCase.expectedResult }}</div>
                    </td>
                    <td>
                      <span 
                        class="badge" 
                        [ngClass]="{
                          'bg-danger': testCase.priority === 'high',
                          'bg-warning text-dark': testCase.priority === 'medium',
                          'bg-info': testCase.priority === 'low'
                        }">
                        {{ testCase.priority }}
                      </span>
                    </td>
                    <td>
                      <select 
                        class="form-select form-select-sm"
                        [(ngModel)]="testCase.executionStatus"
                        (change)="updateTestCaseStatus(testCase)">
                        <option value="not-executed">Not Executed</option>
                        <option value="passed">Passed</option>
                        <option value="failed">Failed</option>
                        <option value="blocked">Blocked</option>
                      </select>
                    </td>
                    <td>
                      <div class="btn-group btn-group-sm">
                        <button 
                          (click)="showEditTestCaseModal(testCase)" 
                          class="btn btn-outline-primary" 
                          title="Edit Test Case">
                          <i class="bi bi-pencil"></i>
                        </button>
                        <button 
                          (click)="deleteTestCase(testCase.id)" 
                          class="btn btn-outline-danger" 
                          title="Delete Test Case">
                          <i class="bi bi-trash"></i>
                        </button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          
          <!-- Connection Status -->
          <!-- <div class="alert mt-4" [ngClass]="{
            'alert-success': connectionStatus.backend && connectionStatus.jiraApi,
            'alert-warning': connectionStatus.backend || connectionStatus.jiraApi,
            'alert-danger': !connectionStatus.backend && !connectionStatus.jiraApi
          }">
            <h5><i class="bi bi-wifi"></i> Backend Connection Status</h5>
            <div class="row">
              <div class="col-md-6">
                <p class="mb-1">
                  <span class="badge me-2" [ngClass]="{
                    'bg-success': connectionStatus.backend,
                    'bg-danger': !connectionStatus.backend
                  }">
                    <i class="bi" [ngClass]="{
                      'bi-check-circle': connectionStatus.backend,
                      'bi-x-circle': !connectionStatus.backend
                    }"></i>
                  </span>
                  <strong>Backend API:</strong> 
                  {{ connectionStatus.backend ? 'Connected' : 'Disconnected' }}
                </p>
                <small class="text-muted">http://localhost:5000</small>
              </div>
              <div class="col-md-6">
                <p class="mb-1">
                  <span class="badge me-2" [ngClass]="{
                    'bg-success': connectionStatus.jiraApi,
                    'bg-danger': !connectionStatus.jiraApi
                  }">
                    <i class="bi" [ngClass]="{
                      'bi-check-circle': connectionStatus.jiraApi,
                      'bi-x-circle': !connectionStatus.jiraApi
                    }"></i>
                  </span>
                  <strong>Jira API:</strong> 
                  {{ connectionStatus.jiraApi ? 'Connected' : 'Disconnected' }}
                </p>
                <small class="text-muted">http://localhost:8000/api/jira</small>
              </div>
            </div>
            <small class="text-muted">Last checked: {{ connectionStatus.lastChecked | date:'short' }}</small>
          </div> -->

          <!-- <div class="alert alert-info mt-4">
            <h5><i class="bi bi-info-circle"></i> Backend API Integration</h5>
            <p class="mb-0">Your Angular frontend is now ready to connect to your backend APIs:</p>
            <ul class="mb-0 mt-2">
              <li><strong>Backend API (Port 5000):</strong> Test case generation, AI processing</li>
              <li><strong>Jira API Proxy (Port 8000):</strong> Jira issues, components, sprints</li>
              <li><strong>Configuration:</strong> Easily configurable via ApiConfigService</li>
              <li><strong>Error Handling:</strong> Built-in error handling and retry logic</li>
            </ul>
          </div> -->
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Components -->

<!-- Issue Details Modal -->
<div class="modal fade" id="issueDetailsModal" tabindex="-1" aria-labelledby="issueDetailsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="issueDetailsModalLabel">
          <i class="bi bi-magic"></i> Generate Test Cases
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" *ngIf="currentIssue">
        <div class="row">
          <div class="col-md-6">
            <h6><i class="bi bi-tag"></i> Issue Details</h6>
            <table class="table table-sm">
              <tr>
                <td><strong>Key:</strong></td>
                <td>{{ currentIssue.key }}</td>
              </tr>
              <tr>
                <td><strong>Type:</strong></td>
                <td>
                  <span class="badge" [style]="badgeUtils.getIssueTypeBadgeClass(currentIssue.issue_type).style">
                    {{ currentIssue.issue_type }}
                  </span>
                </td>
              </tr>
              <tr>
                <td><strong>Status:</strong></td>
                <td>
                  <span class="badge" [style]="badgeUtils.getStatusBadgeClass(currentIssue.status).style">
                    {{ currentIssue.status }}
                  </span>
                </td>
              </tr>
              <tr>
                <td><strong>Priority:</strong></td>
                <td>
                  <span class="badge" [style]="badgeUtils.getPriorityBadgeClass(currentIssue.priority).style">
                    {{ currentIssue.priority }}
                  </span>
                </td>
              </tr>
              <tr>
                <td><strong>Assignee:</strong></td>
                <td>{{ currentIssue.assignee || 'Unassigned' }}</td>
              </tr>
            </table>
          </div>
          <div class="col-md-6">
            <h6><i class="bi bi-info-circle"></i> Summary</h6>
            <p class="text-muted">{{ currentIssue.summary }}</p>
            <h6><i class="bi bi-file-text"></i> Description</h6>
            <div class="text-muted" style="max-height: 200px; overflow-y: auto;">
              {{ currentIssue.description || 'No description available' }}
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button 
          type="button" 
          class="btn btn-primary" 
          (click)="generateTestCases()"
          [disabled]="isGeneratingTestCases">
          <span *ngIf="isGeneratingTestCases" class="spinner-border spinner-border-sm me-2" role="status"></span>
          <i class="bi bi-magic" *ngIf="!isGeneratingTestCases"></i>
          {{ isGeneratingTestCases ? 'Generating...' : 'Generate Test Cases' }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Add Test Case Modal -->
<div class="modal fade" id="addTestCaseModal" tabindex="-1" aria-labelledby="addTestCaseModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addTestCaseModalLabel">
          <i class="bi bi-plus-circle"></i> Add Manual Test Case
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label for="testCaseTitle" class="form-label">Test Case Title *</label>
            <input 
              type="text" 
              class="form-control" 
              id="testCaseTitle" 
              [(ngModel)]="newTestCase.title"
              name="title"
              placeholder="Enter a descriptive title for the test case"
              required>
          </div>
          
          <div class="mb-3">
            <label for="testCaseSteps" class="form-label">Test Steps *</label>
            <textarea 
              class="form-control" 
              id="testCaseSteps" 
              rows="4"
              [(ngModel)]="newTestCase.steps"
              name="steps"
              placeholder="1. Step one&#10;2. Step two&#10;3. Step three"
              required></textarea>
          </div>
          
          <div class="mb-3">
            <label for="testCaseExpectedResult" class="form-label">Expected Result *</label>
            <textarea 
              class="form-control" 
              id="testCaseExpectedResult" 
              rows="3"
              [(ngModel)]="newTestCase.expectedResult"
              name="expectedResult"
              placeholder="Describe the expected outcome"
              required></textarea>
          </div>
          
          <div class="mb-3">
            <label for="testCasePriority" class="form-label">Priority</label>
            <select class="form-select" id="testCasePriority" [(ngModel)]="newTestCase.priority" name="priority">
              <option value="high">High</option>
              <option value="medium">Medium</option>
              <option value="low">Low</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button 
          type="button" 
          class="btn btn-primary" 
          (click)="addTestCase()"
          [disabled]="!newTestCase.title || !newTestCase.steps || !newTestCase.expectedResult">
          <i class="bi bi-plus-circle"></i> Add Test Case
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Edit Test Case Modal -->
<div class="modal fade" id="editTestCaseModal" tabindex="-1" aria-labelledby="editTestCaseModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editTestCaseModalLabel">
          <i class="bi bi-pencil"></i> Edit Test Case
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" *ngIf="editingTestCase">
        <form>
          <div class="mb-3">
            <label for="editTestCaseTitle" class="form-label">Test Case Title *</label>
            <input 
              type="text" 
              class="form-control" 
              id="editTestCaseTitle" 
              [(ngModel)]="editingTestCase.title"
              name="title"
              required>
          </div>
          
          <div class="mb-3">
            <label for="editTestCaseSteps" class="form-label">Test Steps *</label>
            <textarea 
              class="form-control" 
              id="editTestCaseSteps" 
              rows="4"
              [(ngModel)]="editingTestCase.steps"
              name="steps"
              required></textarea>
          </div>
          
          <div class="mb-3">
            <label for="editTestCaseExpectedResult" class="form-label">Expected Result *</label>
            <textarea 
              class="form-control" 
              id="editTestCaseExpectedResult" 
              rows="3"
              [(ngModel)]="editingTestCase.expectedResult"
              name="expectedResult"
              required></textarea>
          </div>
          
          <div class="row">
            <div class="col-md-6">
              <label for="editTestCasePriority" class="form-label">Priority</label>
              <select class="form-select" id="editTestCasePriority" [(ngModel)]="editingTestCase.priority" name="priority">
                <option value="high">High</option>
                <option value="medium">Medium</option>
                <option value="low">Low</option>
              </select>
            </div>
            <div class="col-md-6">
              <label for="editTestCaseStatus" class="form-label">Execution Status</label>
              <select class="form-select" id="editTestCaseStatus" [(ngModel)]="editingTestCase.executionStatus" name="executionStatus">
                <option value="not-executed">Not Executed</option>
                <option value="passed">Passed</option>
                <option value="failed">Failed</option>
                <option value="blocked">Blocked</option>
              </select>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button 
          type="button" 
          class="btn btn-primary" 
          (click)="saveTestCaseChanges()"
          [disabled]="!editingTestCase?.title || !editingTestCase?.steps || !editingTestCase?.expectedResult">
          <i class="bi bi-check-circle"></i> Save Changes
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Issue Details View Modal -->
<div class="modal fade" id="viewIssueModal" tabindex="-1" aria-labelledby="viewIssueModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="viewIssueModalLabel">
          <i class="bi bi-eye"></i> Issue Details
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" *ngIf="currentIssue">
        <div class="row">
          <div class="col-md-8">
            <h4>{{ currentIssue.summary }}</h4>
            <div class="mb-3">
              <span class="badge me-2" [style]="badgeUtils.getIssueTypeBadgeClass(currentIssue.issue_type).style">
                {{ currentIssue.issue_type }}
              </span>
              <span class="badge me-2" [style]="badgeUtils.getStatusBadgeClass(currentIssue.status).style">
                {{ currentIssue.status }}
              </span>
              <span class="badge me-2" [style]="badgeUtils.getPriorityBadgeClass(currentIssue.priority).style">
                {{ currentIssue.priority }}
              </span>
            </div>
            
            <h6>Description</h6>
            <div class="border rounded p-3 bg-light mb-3" style="white-space: pre-wrap;">
              {{ currentIssue.description || 'No description available' }}
            </div>
          </div>
          
          <div class="col-md-4">
            <div class="card">
              <div class="card-header">
                <h6 class="mb-0"><i class="bi bi-info-circle"></i> Issue Information</h6>
              </div>
              <div class="card-body">
                <table class="table table-sm table-borderless">
                  <tr>
                    <td><strong>Key:</strong></td>
                    <td>
                      <a [href]="'https://arrowecommerce.atlassian.net/browse/' + currentIssue.key" 
                         target="_blank" 
                         class="text-decoration-none">
                        {{ currentIssue.key }}
                        <i class="bi bi-box-arrow-up-right ms-1 small"></i>
                      </a>
                    </td>
                  </tr>
                  <tr>
                    <td><strong>Assignee:</strong></td>
                    <td>{{ currentIssue.assignee || 'Unassigned' }}</td>
                  </tr>
                  <tr>
                    <td><strong>Reporter:</strong></td>
                    <td>{{ currentIssue.reporter || 'N/A' }}</td>
                  </tr>
                  <tr *ngIf="currentIssue.sprint">
                    <td><strong>Sprint:</strong></td>
                    <td>{{ currentIssue.sprint }}</td>
                  </tr>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button 
          type="button" 
          class="btn btn-primary" 
          (click)="generateTestCasesFromView()">
          <i class="bi bi-magic"></i> Generate Test Cases
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Import to Jira Modal -->
<div class="modal fade" id="importToJiraModal" tabindex="-1" aria-labelledby="importToJiraModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="importToJiraModalLabel">
          <i class="bi bi-upload"></i> Import Test Cases to Jira
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="alert alert-info">
          <i class="bi bi-info-circle"></i>
          <strong>Import Summary:</strong> {{ testCases.length }} test cases will be imported to Jira project <strong>{{ apiConfig.jiraProjectKey }}</strong>
        </div>

        <!-- Debug Info (remove this after fixing) -->
        <div class="alert alert-secondary small">
          <strong>Debug Info:</strong><br>
          Selected Version ID: "{{ selectedVersionId }}"<br>
          Selected Cycle ID: "{{ selectedCycleId }}"<br>
          Test Cycle Disabled: {{ isTestCycleDisabled }}<br>
          Versions Count: {{ jiraVersions.length }}<br>
          Test Cycles Count: {{ testCycles.length }}
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <label for="versionSelect" class="form-label">Target Version *</label>
              <select class="form-select" id="versionSelect" [(ngModel)]="selectedVersionId" (change)="onVersionChange()">
                <option value="">Select a version</option>
                <option *ngFor="let version of jiraVersions" [value]="version.id">
                  {{ version.name }}
                </option>
              </select>
              <div class="form-text">Choose a version to associate the test cases with</div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="mb-3">
              <label for="testCycleSelect" class="form-label">Test Cycle *</label>
              <select class="form-select" id="testCycleSelect" [(ngModel)]="selectedCycleId" [disabled]="isTestCycleDisabled">
                <option value="">Select a test cycle</option>
                <option *ngFor="let cycle of testCycles" [value]="cycle.id">
                  {{ cycle.name }}
                </option>
              </select>
              <div class="form-text">Choose a test cycle for the test cases</div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h6 class="mb-0"><i class="bi bi-list-check"></i> Test Cases to Import</h6>
          </div>
          <div class="card-body" style="max-height: 300px; overflow-y: auto;">
            <div class="row g-2" *ngFor="let testCase of testCases; let i = index">
              <div class="col-1">
                <span class="badge bg-primary">{{ i + 1 }}</span>
              </div>
              <div class="col-11">
                <div class="fw-medium">{{ testCase.title }}</div>
                <small class="text-muted">Priority: {{ testCase.priority }}</small>
              </div>
            </div>
          </div>
        </div>

        <div class="alert alert-warning mt-3">
          <i class="bi bi-exclamation-triangle"></i>
          <strong>Note:</strong> This will create new test case issues in Jira. Make sure you have the necessary permissions.
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button 
          type="button" 
          class="btn btn-info" 
          (click)="importToJira()"
          [disabled]="!canConfirmImport">
          <span *ngIf="isImportingToJira" class="spinner-border spinner-border-sm me-2" role="status"></span>
          <i class="bi bi-upload" *ngIf="!isImportingToJira"></i>
          {{ isImportingToJira ? 'Importing...' : 'Import to Jira' }}
        </button>
      </div>
    </div>
  </div>
</div>

<router-outlet />
